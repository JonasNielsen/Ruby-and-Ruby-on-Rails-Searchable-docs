<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>RDoc::Markup::PreProcess</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/github.css" type="text/css" media="screen" />
<script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            RDoc::Markup::PreProcess 
            
                <span class="parent">&lt; 
                    
                    <a href="../../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/rdoc/markup/preprocess_rb.html">lib/rdoc/markup/preprocess.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Handle common directives that can occur in a block of text:</p>

<p>: include : filename</p>

<p><a href="../RDoc.html">RDoc</a> plugin authors can register additional
directives to be handled through <a
href="PreProcess.html#method-c-register">::register</a></p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-find_include_file">find_include_file</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>H</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-handle">handle</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-include_file">include_file</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-register">register</a>,
              </li>
            
              
              <li>
                <a href="#method-c-registered">registered</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <a name="method-c-new"></a><b>new</b>(input_file_name, include_path)
            
          </div>
          
          
            <div class="description">
              <p>Creates a new pre-processor for <code>input_file_name</code> that will look
for included files in <code>include_path</code></p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/rdoc/markup/preprocess.rb, line 35</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">initialize</span>(<span class="ruby-identifier">input_file_name</span>, <span class="ruby-identifier">include_path</span>)
  <span class="ruby-ivar">@input_file_name</span> = <span class="ruby-identifier">input_file_name</span>
  <span class="ruby-ivar">@include_path</span> = <span class="ruby-identifier">include_path</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-register">
            
              <a name="method-c-register"></a><b>register</b>(directive, &amp;block)
            
          </div>
          
          
            <div class="description">
              <p>Registers <code>directive</code> as one handled by <a
href="../RDoc.html">RDoc</a>.  If a block is given the directive will be
replaced by the result of the block, otherwise the directive will be
removed from the processed text.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-register_source')" id="l_method-c-register_source">show</a>
                
              </p>
              <div id="method-c-register_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/rdoc/markup/preprocess.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">self</span>.<span class="ruby-identifier">register</span> <span class="ruby-identifier">directive</span>, &amp;<span class="ruby-identifier">block</span>
  <span class="ruby-ivar">@registered</span>[<span class="ruby-identifier">directive</span>] = <span class="ruby-identifier">block</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-registered">
            
              <a name="method-c-registered"></a><b>registered</b>()
            
          </div>
          
          
            <div class="description">
              <p>Registered directives</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-registered_source')" id="l_method-c-registered_source">show</a>
                
              </p>
              <div id="method-c-registered_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/rdoc/markup/preprocess.rb, line 27</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">self</span>.<span class="ruby-identifier">registered</span>
  <span class="ruby-ivar">@registered</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-find_include_file">
            
              <a name="method-i-find_include_file"></a><b>find_include_file</b>(name)
            
          </div>
          
          
            <div class="description">
              <p>Look for the given file in the directory containing the current file, and
then in each of the directories specified in the RDOC_INCLUDE path</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-find_include_file_source')" id="l_method-i-find_include_file_source">show</a>
                
              </p>
              <div id="method-i-find_include_file_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/rdoc/markup/preprocess.rb, line 119</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">find_include_file</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-identifier">to_search</span> = [<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-ivar">@input_file_name</span>)].<span class="ruby-identifier">concat</span> <span class="ruby-ivar">@include_path</span>
  <span class="ruby-identifier">to_search</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">full_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-identifier">name</span>)
    <span class="ruby-identifier">stat</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">full_name</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">full_name</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">readable?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-handle">
            
              <a name="method-i-handle"></a><b>handle</b>(text, code_object = nil)
            
          </div>
          
          
            <div class="description">
              <p>Look for directives in a chunk of <code>text</code>.</p>

<p><a href="../Options.html">Options</a> that we don’t handle are yielded.  If
the block returns false the directive is restored to the text.  If the
block returns nil or no block was given the directive is handled according
to the registered directives. If a String was returned the directive is
replaced with the string.</p>

<p>If no matching directive was registered the directive is restored to the
text.</p>

<p>If <code>code_object</code> is given and the param is set as metadata on
the <code>code_object</code>.  See <a
href="../CodeObject.html#attribute-i-metadata">RDoc::CodeObject#metadata</a></p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-handle_source')" id="l_method-i-handle_source">show</a>
                
              </p>
              <div id="method-i-handle_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/rdoc/markup/preprocess.rb, line 54</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">handle</span> <span class="ruby-identifier">text</span>, <span class="ruby-identifier">code_object</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">text</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/^([ \t]*#?[ \t]*):(\w+):([ \t]*)(.+)?\n/</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">next</span> <span class="ruby-node">$&amp;</span> <span class="ruby-keyword">if</span> <span class="ruby-node">$3</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword">and</span> <span class="ruby-node">$4</span> <span class="ruby-keyword">and</span> <span class="ruby-node">$4</span>[<span class="ruby-number">0</span>, <span class="ruby-number">1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">':'</span>

    <span class="ruby-identifier">prefix</span>    = <span class="ruby-node">$1</span>
    <span class="ruby-identifier">directive</span> = <span class="ruby-node">$2</span>.<span class="ruby-identifier">downcase</span>
    <span class="ruby-identifier">param</span>     = <span class="ruby-node">$4</span>

    <span class="ruby-keyword">case</span> <span class="ruby-identifier">directive</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">'include'</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">param</span>.<span class="ruby-identifier">split</span>[<span class="ruby-number">0</span>]
      <span class="ruby-identifier">include_file</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">prefix</span>

    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-keyword">yield</span> <span class="ruby-identifier">directive</span>, <span class="ruby-identifier">param</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>

      <span class="ruby-keyword">case</span> <span class="ruby-identifier">result</span>
      <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">metadata</span>[<span class="ruby-identifier">directive</span>] = <span class="ruby-identifier">param</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">code_object</span>
        <span class="ruby-keyword">if</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Markup</span><span class="ruby-operator">::</span><span class="ruby-constant">PreProcess</span>.<span class="ruby-identifier">registered</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">directive</span> <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">handler</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Markup</span><span class="ruby-operator">::</span><span class="ruby-constant">PreProcess</span>.<span class="ruby-identifier">registered</span>[<span class="ruby-identifier">directive</span>]
          <span class="ruby-identifier">result</span> = <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">call</span> <span class="ruby-identifier">directive</span>, <span class="ruby-identifier">param</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">handler</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">result</span> = <span class="ruby-node">&quot;#{prefix}:#{directive}: #{param}\n&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">when</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">result</span> = <span class="ruby-node">&quot;#{prefix}:#{directive}: #{param}\n&quot;</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">result</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-include_file">
            
              <a name="method-i-include_file"></a><b>include_file</b>(name, indent)
            
          </div>
          
          
            <div class="description">
              <p><a href="../Include.html">Include</a> a file, indenting it correctly.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-include_file_source')" id="l_method-i-include_file_source">show</a>
                
              </p>
              <div id="method-i-include_file_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/rdoc/markup/preprocess.rb, line 93</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">include_file</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">indent</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">full_name</span> = <span class="ruby-identifier">find_include_file</span>(<span class="ruby-identifier">name</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">content</span> = <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">Encoding</span>) <span class="ruby-keyword">then</span>
                <span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span> <span class="ruby-identifier">full_name</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">full_name</span>
              <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># HACK determine content type and force encoding</span>
    <span class="ruby-identifier">content</span> = <span class="ruby-identifier">content</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">/\A# .*coding[=:].*$/</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">lstrip</span>

    <span class="ruby-comment"># strip leading '#'s, but only if all lines start with them</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">content</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/^[^#]/</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">content</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/^/</span>, <span class="ruby-identifier">indent</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">content</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-node">/^#?/</span>, <span class="ruby-identifier">indent</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Couldn't find file to include '#{name}' from #{@input_file_name}&quot;</span>
    <span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>
    </div>
  </body>
</html>    