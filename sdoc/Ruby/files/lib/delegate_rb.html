<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>delegate.rb</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/github.css" type="text/css" media="screen" />
<script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            delegate.rb
        </h1>
        <ul class="files">
            <li>lib/delegate.rb</li>
            <li>Last modified: 2011-10-27 11:13:37 +0200</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h1 id="label-delegate+--+Support+for+the+Delegation+Pattern">delegate – Support for the Delegation Pattern</h1>

<p>Documentation by James Edward Gray II and Gavin Sinclair</p>

<h2 id="label-Introduction">Introduction</h2>

<p>This library provides three different ways to delegate method calls to an
object.  The easiest to use is <a
href="../../classes/SimpleDelegator.html">SimpleDelegator</a>.  Pass an
object to the constructor and all methods supported by the object will be
delegated.  This object can be changed later.</p>

<p>Going a step further, the top level DelegateClass method allows you to
easily setup delegation through class inheritance.  This is considerably
more flexible and thus probably the most common use for this library.</p>

<p>Finally, if you need full control over the delegation scheme, you can
inherit from the abstract class <a
href="../../classes/Delegator.html">Delegator</a> and customize as needed. 
(If you find yourself needing this control, have a look at
<em>forwardable</em>, also in the standard library.  It may suit your needs
better.)</p>

<h2 id="label-Notes">Notes</h2>

<p>Be advised, RDoc will not detect delegated methods.</p>

<p><strong>delegate.rb provides full-class delegation via the DelegateClass()
method.  For single-method delegation via def_delegator(), see
forwardable.rb.</strong></p>

<h2 id="label-Examples">Examples</h2>

<h3 id="label-SimpleDelegator"><a href="../../classes/SimpleDelegator.html">SimpleDelegator</a></h3>

<p>Here’s a simple example that takes advantage of the fact that
SimpleDelegator’s delegation object can be changed at any time.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Stats</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>
    <span class="ruby-ivar">@source</span> = <span class="ruby-constant">SimpleDelegator</span>.<span class="ruby-identifier">new</span>([])
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">stats</span>( <span class="ruby-identifier">records</span> )
    <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">__setobj__</span>(<span class="ruby-identifier">records</span>)

    <span class="ruby-node">&quot;Elements:  #{@source.size}\n&quot;</span> <span class="ruby-operator">+</span>
    <span class="ruby-node">&quot; Non-Nil:  #{@source.compact.size}\n&quot;</span> <span class="ruby-operator">+</span>
    <span class="ruby-node">&quot;  Unique:  #{@source.uniq.size}\n&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">s</span> = <span class="ruby-constant">Stats</span>.<span class="ruby-identifier">new</span>
<span class="ruby-identifier">puts</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">stats</span>(<span class="ruby-node">%w{James Edward Gray II}</span>)
<span class="ruby-identifier">puts</span>
<span class="ruby-identifier">puts</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">stats</span>([<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">4</span>, <span class="ruby-value">5</span>, <span class="ruby-value">1</span>, <span class="ruby-value">2</span>])
</pre>

<p><em>Prints:</em></p>

<pre>Elements:  4
 Non-Nil:  4
  Unique:  4

Elements:  8
 Non-Nil:  7
  Unique:  6</pre>

<h3 id="label-DelegateClass%28%29">DelegateClass()</h3>

<p>Here’s a sample of use from <em>tempfile.rb</em>.</p>

<p>A <em><a href="../../classes/Tempfile.html">Tempfile</a></em> object is
really just a <em><a href="../../classes/File.html">File</a></em> object
with a few special rules about storage location and/or when the <a
href="../../classes/File.html">File</a> should be deleted.  That makes for
an almost textbook perfect example of how to use delegation.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Tempfile</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">DelegateClass</span>(<span class="ruby-constant">File</span>)
  <span class="ruby-comment"># constant and class member data initialization...</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">basename</span>, <span class="ruby-identifier">tmpdir</span>=<span class="ruby-constant">Dir</span><span class="ruby-operator">::</span><span class="ruby-identifier">tmpdir</span>)
    <span class="ruby-comment"># build up file path/name in var tmpname...</span>

    <span class="ruby-ivar">@tmpfile</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">tmpname</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">RDWR</span><span class="ruby-operator">|</span><span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">CREAT</span><span class="ruby-operator">|</span><span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">EXCL</span>, <span class="ruby-value">0600</span>)

    <span class="ruby-comment"># ...</span>

    <span class="ruby-keyword">super</span>(<span class="ruby-ivar">@tmpfile</span>)

    <span class="ruby-comment"># below this point, all methods of File are supported...</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Delegator"><a href="../../classes/Delegator.html">Delegator</a></h3>

<p>SimpleDelegator’s implementation serves as a nice example here.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">SimpleDelegator</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Delegator</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">obj</span>)
    <span class="ruby-keyword">super</span>             <span class="ruby-comment"># pass obj to Delegator constructor, required</span>
    <span class="ruby-ivar">@delegate_sd_obj</span> = <span class="ruby-identifier">obj</span>    <span class="ruby-comment"># store obj for future use</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">__getobj__</span>
    <span class="ruby-ivar">@delegate_sd_obj</span>          <span class="ruby-comment"># return object we are delegating to, required</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">__setobj__</span>(<span class="ruby-identifier">obj</span>)
    <span class="ruby-ivar">@delegate_sd_obj</span> = <span class="ruby-identifier">obj</span>    <span class="ruby-comment"># change delegation object, a feature we're providing</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">CLASS</span>
          <a href="../../classes/Delegator.html">Delegator</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="../../classes/SimpleDelegator.html">SimpleDelegator</a>
        </li>
      
    </ul>
  


  

  



  

    

    

    


    


    <!-- Methods -->
              </div>
    </div>
  </body>
</html>