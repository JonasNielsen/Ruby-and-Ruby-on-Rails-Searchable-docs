<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>date.rb</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/github.css" type="text/css" media="screen" />
<script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            date.rb
        </h1>
        <ul class="files">
            <li>lib/date.rb</li>
            <li>Last modified: 2011-10-27 11:13:37 +0200</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>date.rb - date and time library</p>

<p>Author: Tadayoshi Funaba 1998-2011</p>

<p>Documentation: William Webber &lt;william@williamwebber.com&gt;</p>

<h2 id="label-Overview">Overview</h2>

<p>This file provides two classes for working with dates and times.</p>

<p>The first class, <a href="../../classes/Date.html">Date</a>, represents
dates. It works with years, months, weeks, and days. See the <a
href="../../classes/Date.html">Date</a> class documentation for more
details.</p>

<p>The second, <a href="../../classes/DateTime.html">DateTime</a>, extends <a
href="../../classes/Date.html">Date</a> to include hours, minutes, seconds,
and fractions of a second.  It provides basic support for time zones.  See
the <a href="../../classes/DateTime.html">DateTime</a> class documentation
for more details.</p>

<h3 id="label-Ways+of+calculating+the+date.">Ways of calculating the date.</h3>

<p>In common usage, the date is reckoned in years since or before the Common
Era (CE/BCE, also known as AD/BC), then as a month and day-of-the-month
within the current year. This is known as the <strong>Civil</strong>
<strong><a href="../../classes/Date.html">Date</a></strong>, and
abbreviated as <code>civil</code> in the <a
href="../../classes/Date.html">Date</a> class.</p>

<p>Instead of year, month-of-the-year,  and day-of-the-month, the date can
also be reckoned in terms of year and day-of-the-year.  This is known as
the <strong>Ordinal</strong> <strong><a
href="../../classes/Date.html">Date</a></strong>, and is abbreviated as
<code>ordinal</code> in the <a href="../../classes/Date.html">Date</a>
class.  (Note that referring to this as the Julian date is incorrect.)</p>

<p>The date can also be reckoned in terms of year, week-of-the-year, and
day-of-the-week.  This is known as the <strong>Commercial</strong>
<strong><a href="../../classes/Date.html">Date</a></strong>, and is
abbreviated as <code>commercial</code> in the <a
href="../../classes/Date.html">Date</a> class.  The commercial week runs
Monday (day-of-the-week 1) to Sunday (day-of-the-week 7), in contrast to
the civil week which runs Sunday (day-of-the-week 0) to Saturday
(day-of-the-week 6).  The first week of the commercial year starts on the
Monday on or before January 1, and the commercial year itself starts on
this Monday, not January 1.</p>

<p>For scientific purposes, it is convenient to refer to a date simply as a
day count, counting from an arbitrary initial day.  The date first chosen
for this was January 1, 4713 BCE. A count of days from this date is the
<strong>Julian</strong> <strong>Day</strong> <strong>Number</strong> or
<strong>Julian</strong> <strong><a
href="../../classes/Date.html">Date</a></strong>, which is abbreviated as
<code>jd</code> in the <a href="../../classes/Date.html">Date</a> class. 
This is in local time, and counts from midnight on the initial day.  The
stricter usage is in UTC, and counts from midday on the initial day.  This
is referred to in the <a href="../../classes/Date.html">Date</a> class as
the <strong>Astronomical</strong> <strong>Julian</strong>
<strong>Day</strong> <strong>Number</strong>, and abbreviated as
<code>ajd</code>.  In the <a href="../../classes/Date.html">Date</a> class,
the Astronomical Julian Day Number includes fractional days.</p>

<p>Another absolute day count is the <strong>Modified</strong>
<strong>Julian</strong> <strong>Day</strong> <strong>Number</strong>, which
takes November 17, 1858 as its initial day. This is abbreviated as
<code>mjd</code> in the <a href="../../classes/Date.html">Date</a> class. 
There is also an <strong>Astronomical</strong> <strong>Modified</strong>
<strong>Julian</strong> <strong>Day</strong> <strong>Number</strong>, which
is in UTC and includes fractional days.  This is abbreviated as
<code>amjd</code> in the <a href="../../classes/Date.html">Date</a> class. 
Like the Modified Julian Day Number (and unlike the Astronomical Julian Day
Number), it counts from midnight.</p>

<p>Alternative calendars such as the Chinese Lunar Calendar, the Islamic
Calendar, or the French Revolutionary Calendar are not supported by the <a
href="../../classes/Date.html">Date</a> class; nor are calendars that are
based on an Era different from the Common Era, such as the Japanese
Imperial Calendar or the Republic of China Calendar.</p>

<h3 id="label-Calendar+Reform">Calendar Reform</h3>

<p>The standard civil year is 365 days long.  However, the solar year is
fractionally longer than this.  To account for this, a
<strong>leap</strong> <strong>year</strong> is occasionally inserted.  This
is a year with 366 days, the extra day falling on February 29. In the early
days of the civil calendar, every fourth year without exception was a leap
year.  This way of reckoning leap years is the <strong>Julian</strong>
<strong>Calendar</strong>.</p>

<p>However, the solar year is marginally shorter than 365 1/4 days, and so the
<strong>Julian</strong> <strong>Calendar</strong> gradually ran slow over
the centuries.  To correct this, every 100th year (but not every 400th
year) was excluded as a leap year. This way of reckoning leap years, which
we use today, is the <strong>Gregorian</strong> <strong>Calendar</strong>.</p>

<p>The Gregorian Calendar was introduced at different times in different
regions.  The day on which it was introduced for a particular region is the
<strong>Day</strong> <strong>of</strong> <strong>Calendar</strong>
<strong>Reform</strong> for that region.  This is abbreviated as
<code>sg</code> (for Start of Gregorian calendar) in the <a
href="../../classes/Date.html">Date</a> class.</p>

<p>Two such days are of particular significance.  The first is October 15,
1582, which was the Day of Calendar Reform for Italy and most Catholic
countries.  The second is September 14, 1752, which was the Day of Calendar
Reform for England and its colonies (including what is now the United
States).  These two dates are available as the constants Date::ITALY and
Date::ENGLAND, respectively.  (By comparison, Germany and Holland, less
Catholic than Italy but less stubborn than England, changed over in 1698;
Sweden in 1753; Russia not till 1918, after the Revolution; and Greece in
1923.  Many Orthodox churches still use the Julian Calendar.  A complete
list of Days of Calendar Reform can be found at <a
href="http://www.polysyllabic.com/GregConv.html.">www.polysyllabic.com/GregConv.html.</a>)</p>

<p>Switching from the Julian to the Gregorian calendar involved skipping a
number of days to make up for the accumulated lag, and the later the switch
was (or is) done, the more days need to be skipped.  So in 1582 in Italy,
4th October was followed by 15th October, skipping 10 days; in 1752 in
England, 2nd September was followed by 14th September, skipping 11 days;
and if I decided to switch from Julian to Gregorian Calendar this midnight,
I would go from 27th July 2003 (Julian) today to 10th August 2003
(Gregorian) tomorrow, skipping 13 days.  The <a
href="../../classes/Date.html">Date</a> class is aware of this gap, and a
supposed date that would fall in the middle of it is regarded as invalid.</p>

<p>The Day of Calendar Reform is relevant to all date representations
involving years.  It is not relevant to the Julian Day Numbers, except for
converting between them and year-based representations.</p>

<p>In the <a href="../../classes/Date.html">Date</a> and <a
href="../../classes/DateTime.html">DateTime</a> classes, the Day of
Calendar Reform or <code>sg</code> can be specified a number of ways. 
First, it can be as the Julian Day Number of the Day of Calendar Reform. 
Second, it can be using the constants Date::ITALY or Date::ENGLAND; these
are in fact the Julian Day Numbers of the Day of Calendar Reform of the
respective regions.  Third, it can be as the constant Date::JULIAN, which
means to always use the Julian Calendar. Finally, it can be as the constant
Date::GREGORIAN, which means to always use the Gregorian Calendar.</p>

<p>Note: in the Julian Calendar, New Years Day was March 25.  The <a
href="../../classes/Date.html">Date</a> class does not follow this
convention.</p>

<h3 id="label-Time+Zones"><a href="../../classes/Time.html">Time</a> Zones</h3>

<p><a href="../../classes/DateTime.html">DateTime</a> objects support a simple
representation of time zones.  <a href="../../classes/Time.html">Time</a>
zones are represented as an offset from UTC, as a fraction of a day.  This
offset is the how much local time is later (or earlier) than UTC. UTC
offset 0 is centred on England (also known as GMT). As you travel east, the
offset increases until you reach the dateline in the middle of the Pacific
Ocean; as you travel west, the offset decreases.  This offset is
abbreviated as <code>of</code> in the <a
href="../../classes/Date.html">Date</a> class.</p>

<p>This simple representation of time zones does not take into account the
common practice of Daylight Savings <a
href="../../classes/Time.html">Time</a> or Summer <a
href="../../classes/Time.html">Time</a>.</p>

<p>Most <a href="../../classes/DateTime.html">DateTime</a> methods return the
date and the time in local time.  The two exceptions are ajd() and amjd(),
which return the date and time in UTC time, including fractional days.</p>

<p>The <a href="../../classes/Date.html">Date</a> class does not support time
zone offsets, in that there is no way to create a <a
href="../../classes/Date.html">Date</a> object with a time zone. However,
methods of the <a href="../../classes/Date.html">Date</a> class when used
by a <a href="../../classes/DateTime.html">DateTime</a> instance will use
the time zone offset of this instance.</p>

<h2 id="label-Examples+of+use">Examples of use</h2>

<h3 id="label-Print+out+the+date+of+every+Sunday+between+two+dates.">Print out the date of every Sunday between two dates.</h3>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">print_sundays</span>(<span class="ruby-identifier">d1</span>, <span class="ruby-identifier">d2</span>)
    <span class="ruby-identifier">d1</span> <span class="ruby-operator">+=</span><span class="ruby-value">1</span> <span class="ruby-keyword">while</span> (<span class="ruby-identifier">d1</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>)
    <span class="ruby-identifier">d1</span>.<span class="ruby-identifier">step</span>(<span class="ruby-identifier">d2</span>, <span class="ruby-value">7</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{Date::MONTHNAMES[date.mon]} #{date.day}&quot;</span>
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">print_sundays</span>(<span class="ruby-constant">Date</span><span class="ruby-operator">::</span><span class="ruby-identifier">civil</span>(<span class="ruby-value">2003</span>, <span class="ruby-value">4</span>, <span class="ruby-value">8</span>), <span class="ruby-constant">Date</span><span class="ruby-operator">::</span><span class="ruby-identifier">civil</span>(<span class="ruby-value">2003</span>, <span class="ruby-value">5</span>, <span class="ruby-value">23</span>))
</pre>

<h3 id="label-Calculate+how+many+seconds+to+go+till+midnight+on+New+Year%27s+Day.">Calculate how many seconds to go till midnight on New Year’s Day.</h3>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">secs_to_new_year</span>(<span class="ruby-identifier">now</span> = <span class="ruby-constant">DateTime</span><span class="ruby-operator">::</span><span class="ruby-identifier">now</span>())
    <span class="ruby-identifier">new_year</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">now</span>.<span class="ruby-identifier">year</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span>)
    <span class="ruby-identifier">dif</span> = <span class="ruby-identifier">new_year</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">now</span>
    <span class="ruby-identifier">hours</span>, <span class="ruby-identifier">mins</span>, <span class="ruby-identifier">secs</span>, <span class="ruby-identifier">ignore_fractions</span> = <span class="ruby-constant">Date</span><span class="ruby-operator">::</span><span class="ruby-identifier">day_fraction_to_time</span>(<span class="ruby-identifier">dif</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">hours</span> * <span class="ruby-value">60</span> * <span class="ruby-value">60</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">mins</span> * <span class="ruby-value">60</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">secs</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">puts</span> <span class="ruby-identifier">secs_to_new_year</span>()
</pre>

    </div>
  


  
    <!-- File only: requires -->
    <div class="sectiontitle">Required Files</div>
    <ul>
      
        <li>date/format</li>
      
        <li>enumerator</li>
      
    </ul>
  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">CLASS</span>
          <a href="../../classes/Date.html">Date</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="../../classes/DateTime.html">DateTime</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="../../classes/Time.html">Time</a>
        </li>
      
    </ul>
  


  

  



  

    

    

    


    


    <!-- Methods -->
              </div>
    </div>
  </body>
</html>